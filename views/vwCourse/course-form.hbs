<form id="frmCourse" method="post" action="{{#if course.id}}/instructor/courses/{{course.id}}{{else}}/instructor/courses{{/if}}">
  <!-- ...các field khác (title, price, category, v.v.) -->

  <div class="mb-3">
    <label class="form-label">Full Description</label>
    <!-- TinyMCE sẽ gắn vào textarea này -->
    <textarea id="long_desc_html" name="long_desc_html" rows="12">
      {{#if course.long_desc_html}}{{{course.long_desc_html}}}{{/if}}
    </textarea>
  </div>

  <button class="btn btn-primary" type="submit">
    {{#if course.id}}Update{{else}}Create{{/if}}
  </button>
</form>

<!-- TinyMCE CDN -->
<script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/7/tinymce.min.js" referrerpolicy="origin"></script>

<script>
  tinymce.init({
    selector: '#long_desc_html',
    menubar: false,
    height: 420,
    plugins: 'lists link image media table codesample code autoresize',
    toolbar: [
      'undo redo | blocks | bold italic underline forecolor backcolor |' +
      ' alignleft aligncenter alignright alignjustify | bullist numlist outdent indent |' +
      ' link image media table codesample | removeformat code'
    ].join(' '),

    // Cho phép paste ảnh và upload ảnh trực tiếp
    automatic_uploads: true,
    images_file_types: 'jpg,jpeg,png,gif,webp',
    // Ta tự xử lý upload để khớp API hiện có (/instructor/upload)
    images_upload_handler: async (blobInfo, progress) => {
      const form = new FormData();
      form.append('file', blobInfo.blob(), blobInfo.filename());

      const res = await fetch('/instructor/upload', {
        method: 'POST',
        body: form
      });
      if (!res.ok) {
        throw new Error('Upload failed: ' + res.status);
      }
      const data = await res.json(); // { url: '/uploads/xxx.png' }
      if (!data?.url) {
        throw new Error('Invalid upload response');
      }
      return data.url; // TinyMCE sẽ chèn <img src="...">
    },

    content_style: 'body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial; font-size:14px}',
  });
</script>

<div class="row">
  <div class="col-3">
    {{> sidebar}}
  </div>

  <div class="col-9">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Courses Management</h3>
      <form class="d-flex" method="get" action="/admin/courses">
        <input name="q" class="form-control me-2" value="{{q}}" placeholder="Search title...">
        <button class="btn btn-outline-primary">Search</button>
      </form>
    </div>

    {{> flash}}

    {{#if courses.length}}
      <div class="table-responsive">
        <table class="table table-hover align-middle">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Category</th>
              <th>Instructor</th>
              <th>Price</th>
              <th>Status</th>
              <th>Updated</th>        {{!-- th√™m c·ªôt nh·ªè --}}
              <th>Views</th>          {{!-- th√™m c·ªôt nh·ªè --}}
              <th class="text-end">Action</th>
            </tr>
          </thead>
          <tbody>
            {{#each courses}}
            <tr>
              <td>{{inc (add ../offset @index)}}</td>
              <td class="text-truncate" style="max-width: 320px;">{{this.title}}</td>
              <td>{{this.category}}</td>
              <td>{{this.instructor}}</td>
              <td>
                {{#if this.promo_price}}
                  <span class="text-decoration-line-through me-1">
                    {{formatCurrency this.price}}
                  </span>
                  <strong>{{formatCurrency this.promo_price}}</strong>
                {{else}}
                  {{#if this.price}}
                    {{formatCurrency this.price}}
                  {{else}}‚Äî{{/if}}
                {{/if}}
              </td>
              <td>
                {{#if this.is_completed}}‚úÖ Completed{{else}}üïì Draft{{/if}}
                {{#if this.is_removed}}<span class="badge bg-secondary ms-1">Hidden</span>{{/if}}
              </td>
              <td class="text-muted small">
                {{#if this.last_updated_at}}{{formatDate this.last_updated_at "DD/MM/YYYY HH:mm"}}{{else}}‚Äî{{/if}}
              </td>
              <td class="text-muted">{{#if this.view_count}}{{this.view_count}}{{else}}‚Äî{{/if}}</td>
              <td class="text-end">
                <form action="/admin/courses/{{this.id}}/remove" method="post" class="d-inline"
                      onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën {{#if this.is_removed}}hi·ªÉn th·ªã l·∫°i{{else}}·∫©n{{/if}} kho√° h·ªçc n√†y?');">
                  {{!-- gi·ªØ l·∫°i q & page ƒë·ªÉ quay v·ªÅ ƒë√∫ng n∆°i --}}
                  <input type="hidden" name="q" value="{{../q}}">
                  <input type="hidden" name="page" value="{{../page}}">
                  <button class="btn btn-sm {{#if this.is_removed}}btn-success{{else}}btn-warning{{/if}}">
                    {{#if this.is_removed}}Unhide{{else}}Hide{{/if}}
                  </button>
                </form>
              </td>
            </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      {{!-- Pagination via helper (baseUrl KH√îNG ch·ª©a &page=) --}}
      {{#with (buildPagination page totalPages (concat "/admin/courses?q=" (encodeURIComponent q))) as |p|}}
        <nav>
          <ul class="pagination">
            {{#if p.hasPrev}}
              <li class="page-item"><a class="page-link" href="{{p.prevUrl}}">Prev</a></li>
            {{/if}}
            {{#each p.pages}}
              <li class="page-item {{#if this.active}}active{{/if}}">
                <a class="page-link" href="{{this.url}}">{{this.page}}</a>
              </li>
            {{/each}}
            {{#if p.hasNext}}   {{!-- ƒë√£ s·ª≠a ../p.hasNext -> p.hasNext --}}
              <li class="page-item"><a class="page-link" href="{{p.nextUrl}}">Next</a></li>
            {{/if}}
          </ul>
        </nav>
      {{/with}}
    {{else}}
      <div class="alert alert-info">Kh√¥ng c√≥ kho√° h·ªçc n√†o.</div>
    {{/if}}
  </div>
</div>

<div class="row page-enter">
  <div class="col-3">
    {{> sidebar}}
  </div>

  <div class="col-9">
    <!-- ===== Header ===== -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
      <div>
        <h3 class="fw-bold mb-0">
          <i class="bi bi-people text-primary me-2"></i> Students
        </h3>
        <div class="text-muted small">Manage student accounts</div>
      </div>

      <form class="d-flex" method="get" action="/admin/students">
        <input name="q" class="form-control me-2" value="{{q}}" placeholder="Search name or email...">
        <button class="btn btn-primary">
          <i class="bi bi-search"></i>
        </button>
      </form>
    </div>

    {{> flash}}

    <!-- ===== Table ===== -->
    {{#if students.length}}
      <div class="table-responsive card border-0 shadow-sm table-enter">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light sticky-top">
            <tr>
              <th style="width:60px;">#</th>
              <th>Name</th>
              <th>Email</th>
              <th style="width:140px;">Joined</th>
              <th style="width:120px;">Status</th>
              <th class="text-end" style="width:200px;">Action</th>
            </tr>
          </thead>
          <tbody>
            {{#each students}}
              <tr>
                <td>{{inc (add ../offset @index)}}</td>

                <td class="fw-semibold">{{this.name}}</td>

                <td class="text-truncate" style="max-width:260px;">
                  <a href="mailto:{{this.email}}" class="text-decoration-none">{{this.email}}</a>
                </td>

                <td class="text-muted small">{{formatDate this.created_at "DD/MM/YYYY"}}</td>

                <td>
                  {{#if this.is_available}}
                    <span class="badge bg-success-subtle text-success border border-success-subtle">
                      <i class="bi bi-check-circle me-1"></i> Available
                    </span>
                  {{else}}
                    <span class="badge bg-secondary">
                      <i class="bi bi-lock me-1"></i> Locked
                    </span>
                  {{/if}}
                </td>

                <td class="text-end">
                  <a href="/admin/students/{{this.id}}" class="btn btn-sm btn-outline-primary me-1">
                    <i class="bi bi-eye"></i> View
                  </a>

      <form action="/admin/students/{{this.id}}/availability" method="post" class="d-inline"
        onsubmit="return confirm('Do you want to {{#if this.is_available}}DEACTIVATE{{else}}ACTIVATE{{/if}} this student account?');">
                    <input type="hidden" name="q" value="{{../q}}">
                    <input type="hidden" name="page" value="{{../page}}">
                    <input type="hidden" name="available" value="{{#if this.is_available}}0{{else}}1{{/if}}">
                    <button class="btn btn-sm {{#if this.is_available}}btn-warning{{else}}btn-success{{/if}}">
                      {{#if this.is_available}}
                        <i class="bi bi-lock"></i> Lock
                      {{else}}
                        <i class="bi bi-unlock"></i> Unlock
                      {{/if}}
                    </button>
                  </form>
                </td>
              </tr>
            {{/each}}
          </tbody>
        </table>
      </div>

      <!-- ===== Pagination ===== -->
      {{#if (gt totalPages 1)}}
        {{#with (buildPagination page totalPages (concat "/admin/students?q=" (encodeURIComponent q))) as |p|}}
          <div class="d-flex justify-content-between align-items-center mt-3">
            <div class="text-muted small">
              Page <strong>{{page}}</strong> of <strong>{{totalPages}}</strong>
            </div>

            <nav>
              <ul class="pagination mb-0">
                <li class="page-item {{#unless p.hasPrev}}disabled{{/unless}}">
                  <a class="page-link" href="{{#if p.hasPrev}}{{p.prevUrl}}{{else}}#{{/if}}">
                    <i class="bi bi-chevron-left"></i>
                  </a>
                </li>

                {{#each p.pages}}
                  <li class="page-item {{#if this.active}}active{{/if}}">
                    <a class="page-link" href="{{this.url}}">{{this.page}}</a>
                  </li>
                {{/each}}

                <li class="page-item {{#unless p.hasNext}}disabled{{/unless}}">
                  <a class="page-link" href="{{#if p.hasNext}}{{p.nextUrl}}{{else}}#{{/if}}">
                    <i class="bi bi-chevron-right"></i>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        {{/with}}
      {{/if}}

    {{else}}
      <div class="alert alert-info d-flex justify-content-between align-items-center mt-3">
        <div>No students found.</div>
        <a href="/admin/students" class="btn btn-primary">
          <i class="bi bi-arrow-clockwise"></i> Refresh
        </a>
      </div>
    {{/if}}
  </div>
</div>

<!-- ===== CSS & Motion ===== -->
<style>
  @media (prefers-reduced-motion:no-preference){
    .page-enter{animation:fadeUp .4s ease-out both}
    .table-enter{animation:fadeUp .45s .05s ease-out both}
  }
  @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}

  .table tbody tr:hover{background:rgba(13,110,253,.05);transition:background .2s ease}
  .badge{font-size:.85rem;padding:.4em .6em}
  .btn-sm i{vertical-align:-1px}

  /* Pagination */
  .pagination {
    --bs-pagination-active-bg: var(--bs-primary);
    --bs-pagination-active-border-color: var(--bs-primary);
  }
  .pagination .page-item.disabled .page-link {
    color: #999;
    pointer-events: none;
    background: #f9f9f9;
  }
  .pagination .page-link {
    transition: all 0.2s ease;
    border-radius: 6px;
    margin: 0 2px;
  }
  .pagination .page-link:hover {
    background: rgba(13,110,253,0.1);
  }
</style>

<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold mb-0">
      <i class="bi bi-collection-play me-2"></i> My Courses
    </h3>
    <a class="btn btn-primary" href="/instructor/courses/new">
      <i class="bi bi-plus-circle me-1"></i> New Course
    </a>
  </div>

  {{> flash}}

  {{#if courses.length}}
    <div class="table-responsive shadow-sm rounded-3 border bg-white">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light text-secondary small text-uppercase">
          <tr>
            <th style="width:50px;">#</th>
            <th>Course</th>
            <th style="width:180px;">Category</th>
            <th style="width:140px;">Price</th>
            <th style="width:120px;">Status</th>
            <th class="text-end" style="width:180px;">Action</th>
          </tr>
        </thead>
        <tbody>
          {{#each courses}}
          <tr>
            <td class="text-muted">{{inc @index}}</td>

            <!-- Course title + thumbnail -->
            <td class="text-truncate" style="max-width: 420px;">
              <div class="d-flex align-items-center gap-3">
                {{#if this.cover_url}}
                  <img src="{{this.cover_url}}" alt="cover" class="rounded border"
                       style="width:72px;height:72px;object-fit:cover;">
                {{else}}
                  <div class="rounded bg-light border d-flex align-items-center justify-content-center"
                       style="width:72px;height:72px;">
                    <i class="bi bi-image text-muted fs-4"></i>
                  </div>
                {{/if}}

                <div class="flex-grow-1">
                  <a href="/instructor/courses/{{this.id}}/edit" class="fw-semibold text-decoration-none text-dark">
                    {{this.title}}
                  </a>
                  <div class="small text-muted mt-1">
                    {{#if this.last_updated_at}}
                      <i class="bi bi-clock me-1"></i> Updated: {{dateVN this.last_updated_at}}
                    {{/if}}
                  </div>
                </div>
              </div>
            </td>

            <!-- Category -->
            <td>
              <span class="badge bg-light text-dark border">
                {{#if this.category}}{{this.category}}{{else}}{{this.cat_id}}{{/if}}
              </span>
            </td>

            <!-- Price -->
            <td>
              {{#if this.promo_price}}
                <span class="text-decoration-line-through text-muted small me-1">
                  {{formatCurrency this.price}}
                </span>
                <strong class="text-success">{{formatCurrency this.promo_price}}</strong>
              {{else}}
                {{#if this.price}}
                  <span>{{formatCurrency this.price}}</span>
                {{else}}
                  <span class="text-muted">Free</span>
                {{/if}}
              {{/if}}
            </td>

            <!-- Status -->
            <td>
              {{#if this.is_removed}}
                <span class="badge bg-secondary">Hidden</span>
              {{else if this.is_completed}}
                <span class="badge bg-success">Completed</span>
              {{else}}
                <span class="badge bg-warning text-dark">Draft</span>
              {{/if}}
            </td>

            <!-- Actions -->
            <td class="text-end">
              <a href="/instructor/courses/{{this.id}}/edit" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-pencil-square me-1"></i> Edit
              </a>

              {{#unless this.is_completed}}
                <form action="/instructor/courses/{{this.id}}/complete" method="post" class="d-inline"
                      onsubmit="return confirm('Mark this course as completed?');">
                  <button class="btn btn-sm btn-success"
                          {{#if this._cannotComplete}}disabled title="Cần ít nhất 1 Section và 1 Lesson"{{/if}}>
                    <i class="bi bi-check2-circle me-1"></i> Complete
                  </button>
                </form>
              {{/unless}}
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    {{#with (buildPagination page totalPages "/instructor/my-course") as |p|}}
      <nav aria-label="Courses pages" class="mt-4">
        <ul class="pagination justify-content-center">
          {{#if p.hasPrev}}
            <li class="page-item">
              <a class="page-link" href="{{p.prevUrl}}">Prev</a>
            </li>
          {{/if}}

          {{#each p.pages}}
            <li class="page-item {{#if this.active}}active{{/if}}">
              <a class="page-link" href="{{this.url}}">{{this.page}}</a>
            </li>
          {{/each}}

          {{#if p.hasNext}}
            <li class="page-item">
              <a class="page-link" href="{{p.nextUrl}}">Next</a>
            </li>
          {{/if}}
        </ul>
      </nav>
    {{/with}}
  {{else}}
    <div class="alert alert-info d-flex justify-content-between align-items-center shadow-sm border">
      <div>
        <i class="bi bi-info-circle me-2"></i> Bạn chưa có khoá học nào.
      </div>
      <a class="btn btn-primary" href="/instructor/courses/new">
        <i class="bi bi-plus-circle me-1"></i> Create your first course
      </a>
    </div>
  {{/if}}
</div>
